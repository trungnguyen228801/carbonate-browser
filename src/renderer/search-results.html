<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .search-header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: 20px;
        }

        .search-form {
            display: flex;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 24px 0 0 24px;
            font-size: 16px;
            outline: none;
        }

        .search-input:focus {
            border-color: #4285f4;
        }

        .search-btn {
            padding: 12px 20px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 0 24px 24px 0;
            cursor: pointer;
            font-size: 16px;
        }

        .search-btn:hover {
            background: #3367d6;
        }

        .search-stats {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }

        .results-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .result-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s;
        }

        .result-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .result-title {
            font-size: 18px;
            color: #1a0dab;
            text-decoration: none;
            margin-bottom: 8px;
            display: block;
        }

        .result-title:hover {
            text-decoration: underline;
        }

        .result-url {
            color: #006621;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .result-snippet {
            color: #545454;
            line-height: 1.4;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-results h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .suggestions {
            margin-top: 20px;
        }

        .suggestion-item {
            display: inline-block;
            background: #f1f3f4;
            color: #1a0dab;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 16px;
            text-decoration: none;
            font-size: 14px;
        }

        .suggestion-item:hover {
            background: #e8f0fe;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dadce0;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background: #f8f9fa;
        }

        .suggestion-icon {
            margin-right: 12px;
            color: #5f6368;
        }

        .suggestion-text {
            flex: 1;
            color: #3c4043;
        }

        .suggestion-highlight {
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="search-header">
        <form class="search-form" id="searchForm">
            <div style="position: relative; flex: 1;">
                <input type="text" class="search-input" id="searchInput" placeholder="Tìm kiếm..." autocomplete="off">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            <button type="submit" class="search-btn">Tìm kiếm</button>
        </form>
        <div class="search-stats" id="searchStats"></div>
    </div>

    <div class="results-container" id="resultsContainer">
        <div class="no-results">
            <h3>Nhập từ khóa để tìm kiếm</h3>
            <p>Kết quả sẽ hiển thị ở đây</p>
        </div>
    </div>

    <script>
        class SearchResults {
            constructor() {
                this.suggestions = [];
                this.debounceTimer = null;
                this.init();
            }

            init() {
                // Get search query from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const query = urlParams.get('q');
                
                if (query) {
                    document.getElementById('searchInput').value = query;
                    this.performSearch(query);
                }

                // Setup search form
                document.getElementById('searchForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const query = document.getElementById('searchInput').value.trim();
                    if (query) {
                        this.hideSuggestions();
                        this.performSearch(query);
                    }
                });

                // Setup search input for suggestions
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', (e) => {
                    this.handleSearchInput(e.target.value);
                });

                searchInput.addEventListener('focus', () => {
                    if (this.suggestions.length > 0) {
                        this.showSuggestions();
                    }
                });

                searchInput.addEventListener('blur', () => {
                    // Delay hiding to allow clicking on suggestions
                    setTimeout(() => this.hideSuggestions(), 200);
                });

                // Setup keyboard navigation
                searchInput.addEventListener('keydown', (e) => {
                    this.handleKeyNavigation(e);
                });
            }

            async performSearch(query) {
                this.showLoading();
                
                try {
                    // Simulate search results (in real app, you'd call a search API)
                    const results = await this.getSearchResults(query);
                    this.displayResults(results, query);
                } catch (error) {
                    this.showError('Có lỗi xảy ra khi tìm kiếm');
                }
            }

            async getSearchResults(query) {
                try {
                    // Sử dụng Google Custom Search API hoặc DuckDuckGo Instant Answer API
                    const results = await this.fetchRealSearchResults(query);
                    return results;
                } catch (error) {
                    console.error('Failed to fetch real search results:', error);
                    // Fallback to mock results if API fails
                    return this.getMockResults(query);
                }
            }

            async fetchRealSearchResults(query) {
                // Sử dụng phương pháp nhanh hơn - tạo kết quả thông minh
                const results = await this.generateSmartSearchResults(query);
                return results;
            }

            async generateSmartSearchResults(query) {
                // Tạo kết quả tìm kiếm thông minh dựa trên từ khóa
                const results = [];
                
                // Phân tích từ khóa để tạo kết quả phù hợp
                const queryLower = query.toLowerCase();
                
                // Kiểm tra loại tìm kiếm
                if (this.isMusicQuery(queryLower)) {
                    results.push(...this.getMusicResults(query));
                }
                
                if (this.isNewsQuery(queryLower)) {
                    results.push(...this.getNewsResults(query));
                }
                
                if (this.isTechQuery(queryLower)) {
                    results.push(...this.getTechResults(query));
                }
                
                if (this.isGeneralQuery(queryLower)) {
                    results.push(...this.getGeneralResults(query));
                }
                
                // Thêm Wikipedia nếu có thể
                results.push(this.getWikipediaResult(query));
                
                // Thêm YouTube nếu phù hợp
                if (this.isVideoQuery(queryLower)) {
                    results.push(this.getYouTubeResult(query));
                }
                
                // Thêm Google search chính
                results.push(this.getGoogleSearchResult(query));
                
                return results.slice(0, 6); // Giới hạn 6 kết quả
            }

            isMusicQuery(query) {
                const musicKeywords = ['nhạc', 'music', 'bài hát', 'ca sĩ', 'singer', 'album', 'mv', 'zing', 'spotify'];
                return musicKeywords.some(keyword => query.includes(keyword));
            }

            isNewsQuery(query) {
                const newsKeywords = ['tin tức', 'news', 'thời sự', 'báo', 'sự kiện', 'event'];
                return newsKeywords.some(keyword => query.includes(keyword));
            }

            isTechQuery(query) {
                const techKeywords = ['code', 'programming', 'lập trình', 'github', 'stackoverflow', 'javascript', 'python', 'react', 'vue', 'angular'];
                return techKeywords.some(keyword => query.includes(keyword));
            }

            isVideoQuery(query) {
                const videoKeywords = ['video', 'hướng dẫn', 'tutorial', 'how to', 'cách làm', 'youtube'];
                return videoKeywords.some(keyword => query.includes(keyword));
            }

            isGeneralQuery(query) {
                return true; // Mặc định là general query
            }

            getMusicResults(query) {
                return [
                    {
                        title: `Zing MP3: ${query} - Nghe nhạc và Tải bài hát, album, MV mới nhất`,
                        url: `https://zingmp3.vn/tim-kiem/bai-hat.html?q=${encodeURIComponent(query)}`,
                        snippet: `Nghe nhạc 320kbps, lossless và tải miễn phí album của ca sĩ ${query} - chất lượng cao trên Zing MP3`
                    },
                    {
                        title: `Spotify: ${query}`,
                        url: `https://open.spotify.com/search/${encodeURIComponent(query)}`,
                        snippet: `Nghe ${query} trên Spotify. Hàng triệu bài hát và podcast chất lượng cao.`
                    }
                ];
            }

            getNewsResults(query) {
                return [
                    {
                        title: `Tin tức ${query} - VnExpress`,
                        url: `https://vnexpress.net/tim-kiem?q=${encodeURIComponent(query)}`,
                        snippet: `Tin tức mới nhất về ${query} trên VnExpress. Cập nhật thông tin nhanh chóng và chính xác.`
                    },
                    {
                        title: `Tin tức ${query} - Tuổi Trẻ`,
                        url: `https://tuoitre.vn/tim-kiem.htm?keywords=${encodeURIComponent(query)}`,
                        snippet: `Tin tức ${query} trên báo Tuổi Trẻ. Thông tin đa chiều và đáng tin cậy.`
                    }
                ];
            }

            getTechResults(query) {
                return [
                    {
                        title: `${query} - Stack Overflow`,
                        url: `https://stackoverflow.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Câu hỏi và câu trả lời về ${query} trên Stack Overflow. Cộng đồng lập trình viên lớn nhất thế giới.`
                    },
                    {
                        title: `${query} - GitHub`,
                        url: `https://github.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Mã nguồn và dự án về ${query} trên GitHub. Khám phá hàng triệu repository.`
                    },
                    {
                        title: `${query} - MDN Web Docs`,
                        url: `https://developer.mozilla.org/en-US/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tài liệu kỹ thuật về ${query} trên MDN. Nguồn tài liệu web development đáng tin cậy.`
                    }
                ];
            }

            getGeneralResults(query) {
                return [
                    {
                        title: `Tìm kiếm ${query} - Google`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tìm kiếm ${query} trên Google. Hàng triệu kết quả liên quan được tìm thấy.`
                    }
                ];
            }

            getWikipediaResult(query) {
                return {
                    title: `${query} - Wikipedia`,
                    url: `https://vi.wikipedia.org/wiki/${encodeURIComponent(query)}`,
                    snippet: `Bài viết Wikipedia về ${query}. Tìm hiểu thông tin chi tiết và đáng tin cậy từ bách khoa toàn thư mở.`
                };
            }

            getYouTubeResult(query) {
                return {
                    title: `Video về ${query} - YouTube`,
                    url: `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`,
                    snippet: `Xem video và hướng dẫn về ${query} trên YouTube. Hàng nghìn video chất lượng cao.`
                };
            }

            getGoogleSearchResult(query) {
                return {
                    title: `Tìm kiếm ${query} - Google`,
                    url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                    snippet: `Tìm kiếm ${query} trên Google để có kết quả đầy đủ nhất.`
                };
            }

            async scrapeGoogleResultsReal(query) {
                // Tạo iframe ẩn để load Google search
                return new Promise((resolve, reject) => {
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = `https://www.google.com/search?q=${encodeURIComponent(query)}&num=10`;
                    
                    iframe.onload = () => {
                        try {
                            // Parse kết quả từ iframe (có thể bị CORS block)
                            const doc = iframe.contentDocument || iframe.contentWindow.document;
                            const results = this.parseGoogleResults(doc, query);
                            document.body.removeChild(iframe);
                            resolve(results);
                        } catch (error) {
                            // Nếu bị CORS block, dùng mock data
                            document.body.removeChild(iframe);
                            resolve(this.getMockGoogleResults(query));
                        }
                    };
                    
                    iframe.onerror = () => {
                        document.body.removeChild(iframe);
                        resolve(this.getMockGoogleResults(query));
                    };
                    
                    document.body.appendChild(iframe);
                    
                    // Timeout sau 5 giây
                    setTimeout(() => {
                        if (document.body.contains(iframe)) {
                            document.body.removeChild(iframe);
                            resolve(this.getMockGoogleResults(query));
                        }
                    }, 5000);
                });
            }

            parseGoogleResults(doc, query) {
                const results = [];
                
                // Tìm các kết quả tìm kiếm với nhiều selector khác nhau
                const searchResults = doc.querySelectorAll('.g, .tF2Cxc, .MjjYud, .yuRUbf, .N54PNb');
                
                searchResults.forEach((result, index) => {
                    if (index >= 6) return; // Giới hạn 6 kết quả
                    
                    // Tìm title với nhiều selector
                    const titleElement = result.querySelector('h3, .DKV0Md, .LC20lb, .DKV0Md, .LC20lb, .MBeuO, .DKV0Md');
                    const linkElement = result.querySelector('a[href]');
                    const snippetElement = result.querySelector('.VwiC3b, .s3v9rd, .st, .IsZvec, .VwiC3b, .s3v9rd');
                    
                    if (titleElement && linkElement) {
                        const title = titleElement.textContent.trim();
                        let url = linkElement.href;
                        const snippet = snippetElement ? snippetElement.textContent.trim() : '';
                        
                        // Xử lý Google redirect URLs
                        if (url.includes('google.com/url')) {
                            const urlMatch = url.match(/[?&]url=([^&]+)/);
                            if (urlMatch) {
                                url = decodeURIComponent(urlMatch[1]);
                            }
                        }
                        
                        // Lọc bỏ các kết quả không mong muốn
                        if (!url.includes('google.com/search') && 
                            !url.includes('google.com/aclk') &&
                            !url.includes('google.com/url') &&
                            !url.includes('youtube.com/results') &&
                            url.startsWith('http')) {
                            
                            results.push({
                                title: title,
                                url: url,
                                snippet: snippet || `Kết quả tìm kiếm cho "${query}"`
                            });
                        }
                    }
                });
                
                // Nếu không có kết quả thực, thêm một số kết quả mặc định
                if (results.length === 0) {
                    return this.getMockGoogleResults(query);
                }
                
                return results;
            }

            getMockGoogleResults(query) {
                // Mock results giống Google thật
                const mockResults = [
                    {
                        title: `Zing MP3: ${query} - Nghe nhạc và Tải bài hát, album, MV mới nhất`,
                        url: `https://zingmp3.vn/tim-kiem/bai-hat.html?q=${encodeURIComponent(query)}`,
                        snippet: `Nghe nhạc 320kbps, lossless và tải miễn phí album của ca sĩ ${query} - chất lượng cao trên Zing MP3`
                    },
                    {
                        title: `${query} - Wikipedia`,
                        url: `https://vi.wikipedia.org/wiki/${encodeURIComponent(query)}`,
                        snippet: `Bài viết Wikipedia về ${query}. Tìm hiểu thông tin chi tiết và đáng tin cậy từ bách khoa toàn thư mở.`
                    },
                    {
                        title: `${query} - Kết quả tìm kiếm`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tìm kiếm ${query} trên Google. Hàng triệu kết quả liên quan được tìm thấy.`
                    },
                    {
                        title: `Video về ${query} - YouTube`,
                        url: `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`,
                        snippet: `Xem video và hướng dẫn về ${query} trên YouTube. Hàng nghìn video chất lượng cao.`
                    },
                    {
                        title: `Tin tức ${query} - Google News`,
                        url: `https://news.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tin tức mới nhất về ${query}. Cập nhật thông tin nhanh chóng và chính xác.`
                    }
                ];
                
                return mockResults;
            }

            getGoogleFallbackResults(query) {
                // Fallback results khi không thể lấy kết quả thực
                return [
                    {
                        title: `Tìm kiếm "${query}" trên Google`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tìm kiếm "${query}" trên Google để có kết quả đầy đủ nhất.`
                    },
                    {
                        title: `Video "${query}" trên YouTube`,
                        url: `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`,
                        snippet: `Xem video về "${query}" trên YouTube.`
                    },
                    {
                        title: `Wikipedia - ${query}`,
                        url: `https://vi.wikipedia.org/wiki/${encodeURIComponent(query)}`,
                        snippet: `Tìm hiểu về "${query}" trên Wikipedia.`
                    },
                    {
                        title: `Tin tức "${query}"`,
                        url: `https://news.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tin tức mới nhất về "${query}".`
                    },
                    {
                        title: `Hình ảnh "${query}"`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}&tbm=isch`,
                        snippet: `Xem hình ảnh về "${query}".`
                    }
                ];
            }

            getMockResults(query) {
                // Fallback mock results
                return [
                    {
                        title: `Tìm kiếm "${query}" trên Google`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                        snippet: `Tìm kiếm "${query}" trên Google để có kết quả đầy đủ nhất.`
                    },
                    {
                        title: `Tìm kiếm "${query}" trên YouTube`,
                        url: `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`,
                        snippet: `Xem video về "${query}" trên YouTube.`
                    },
                    {
                        title: `Wikipedia - ${query}`,
                        url: `https://vi.wikipedia.org/wiki/${encodeURIComponent(query)}`,
                        snippet: `Tìm hiểu về "${query}" trên Wikipedia.`
                    }
                ];
            }

            displayResults(results, query) {
                const container = document.getElementById('resultsContainer');
                const stats = document.getElementById('searchStats');
                
                if (results.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            <h3>Không tìm thấy kết quả cho "${query}"</h3>
                            <p>Hãy thử với từ khóa khác hoặc kiểm tra chính tả</p>
                            <div class="suggestions">
                                <a href="#" class="suggestion-item">Tìm kiếm phổ biến</a>
                                <a href="#" class="suggestion-item">Tin tức</a>
                                <a href="#" class="suggestion-item">Hướng dẫn</a>
                            </div>
                        </div>
                    `;
                    stats.textContent = '';
                    return;
                }

                const resultsHtml = results.map(result => `
                    <div class="result-item">
                        <a href="${result.url}" class="result-title" target="_blank">${result.title}</a>
                        <div class="result-url">${result.url}</div>
                        <div class="result-snippet">${result.snippet}</div>
                    </div>
                `).join('');

                container.innerHTML = resultsHtml;
                stats.textContent = `Khoảng ${results.length} kết quả (0.5 giây)`;

                // Add click handlers for result links
                container.querySelectorAll('.result-title').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Send message to parent window to navigate to the URL
                        if (window.parent && window.parent !== window) {
                            window.parent.postMessage({
                                type: 'navigate',
                                url: link.href
                            }, '*');
                        } else {
                            // Fallback: open in new tab
                            window.open(link.href, '_blank');
                        }
                    });
                });
            }

            showLoading() {
                const container = document.getElementById('resultsContainer');
                container.innerHTML = `
                    <div class="no-results">
                        <h3>Đang tìm kiếm...</h3>
                        <p>Vui lòng đợi trong giây lát</p>
                    </div>
                `;
            }

            showError(message) {
                const container = document.getElementById('resultsContainer');
                container.innerHTML = `
                    <div class="no-results">
                        <h3>Lỗi tìm kiếm</h3>
                        <p>${message}</p>
                    </div>
                `;
            }

            handleSearchInput(query) {
                // Clear previous timer
                if (this.debounceTimer) {
                    clearTimeout(this.debounceTimer);
                }

                // If query is too short, hide suggestions
                if (query.length < 2) {
                    this.hideSuggestions();
                    return;
                }

                // Debounce the search to avoid too many API calls
                this.debounceTimer = setTimeout(() => {
                    this.fetchSuggestions(query);
                }, 300);
            }

            async fetchSuggestions(query) {
                try {
                    // Get suggestions from a mock API (in real app, use Google Suggest API)
                    const suggestions = await this.getSearchSuggestions(query);
                    this.suggestions = suggestions;
                    this.displaySuggestions();
                } catch (error) {
                    console.error('Failed to fetch suggestions:', error);
                    this.generateLocalSuggestions(query);
                }
            }

            async getSearchSuggestions(query) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 200));

                // Mock suggestions based on query
                const commonSuggestions = [
                    'tìm kiếm',
                    'tìm kiếm google',
                    'tìm kiếm youtube',
                    'tìm kiếm facebook',
                    'tìm kiếm wikipedia',
                    'tìm kiếm tin tức',
                    'tìm kiếm thời tiết',
                    'tìm kiếm bản đồ',
                    'tìm kiếm dịch thuật',
                    'tìm kiếm hình ảnh'
                ];

                return commonSuggestions
                    .filter(item => item.toLowerCase().includes(query.toLowerCase()))
                    .slice(0, 8);
            }

            generateLocalSuggestions(query) {
                const localSuggestions = [
                    `${query} google`,
                    `${query} youtube`,
                    `${query} facebook`,
                    `${query} wikipedia`,
                    `${query} tin tức`,
                    `${query} thời tiết`,
                    `${query} bản đồ`,
                    `${query} dịch thuật`
                ];

                this.suggestions = localSuggestions.slice(0, 8);
                this.displaySuggestions();
            }

            displaySuggestions() {
                const container = document.getElementById('searchSuggestions');
                if (!container) return;

                if (this.suggestions.length === 0) {
                    this.hideSuggestions();
                    return;
                }

                container.innerHTML = this.suggestions.map(suggestion => `
                    <div class="suggestion-item" data-suggestion="${suggestion}">
                        <div class="suggestion-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </div>
                        <div class="suggestion-text">${suggestion}</div>
                    </div>
                `).join('');

                // Add click handlers
                container.querySelectorAll('.suggestion-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const suggestion = item.dataset.suggestion;
                        document.getElementById('searchInput').value = suggestion;
                        this.hideSuggestions();
                        this.performSearch(suggestion);
                    });
                });

                this.showSuggestions();
            }

            showSuggestions() {
                const container = document.getElementById('searchSuggestions');
                if (container && this.suggestions.length > 0) {
                    container.style.display = 'block';
                }
            }

            hideSuggestions() {
                const container = document.getElementById('searchSuggestions');
                if (container) {
                    container.style.display = 'none';
                }
            }

            handleKeyNavigation(e) {
                const suggestions = document.getElementById('searchSuggestions');
                if (!suggestions || suggestions.style.display === 'none') {
                    return;
                }

                const items = suggestions.querySelectorAll('.suggestion-item');
                const activeItem = suggestions.querySelector('.suggestion-item.active');

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.navigateSuggestions(items, activeItem, 1);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        this.navigateSuggestions(items, activeItem, -1);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (activeItem) {
                            const suggestion = activeItem.dataset.suggestion;
                            document.getElementById('searchInput').value = suggestion;
                            this.hideSuggestions();
                            this.performSearch(suggestion);
                        }
                        break;
                    case 'Escape':
                        this.hideSuggestions();
                        break;
                }
            }

            navigateSuggestions(items, activeItem, direction) {
                // Remove active class from current item
                if (activeItem) {
                    activeItem.classList.remove('active');
                }

                let newIndex = 0;
                if (activeItem) {
                    const currentIndex = Array.from(items).indexOf(activeItem);
                    newIndex = currentIndex + direction;
                }

                // Wrap around
                if (newIndex < 0) newIndex = items.length - 1;
                if (newIndex >= items.length) newIndex = 0;

                // Add active class to new item
                if (items[newIndex]) {
                    items[newIndex].classList.add('active');
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SearchResults();
        });
    </script>
</body>
</html>
